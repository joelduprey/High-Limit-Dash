<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starting Order</title>
    <style>
        .highlight {
            background-color: yellow;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>

    <h2>Driver Input</h2>
    <table>
        <thead>
            <tr>
                <th>Driver Name</th>
                <th>Spin</th>
                <th>Qualifying Time (Seconds)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" id="driver1" placeholder="Driver 1"></td>
                <td><input type="text" id="spin1" placeholder="Spin"></td>
                <td><input type="text" id="time1" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver2" placeholder="Driver 2"></td>
                <td><input type="text" id="spin2" placeholder="Spin"></td>
                <td><input type="text" id="time2" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver3" placeholder="Driver 3"></td>
                <td><input type="text" id="spin3" placeholder="Spin"></td>
                <td><input type="text" id="time3" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver4" placeholder="Driver 4"></td>
                <td><input type="text" id="spin4" placeholder="Spin"></td>
                <td><input type="text" id="time4" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver5" placeholder="Driver 5"></td>
                <td><input type="text" id="spin5" placeholder="Spin"></td>
                <td><input type="text" id="time5" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver6" placeholder="Driver 6"></td>
                <td><input type="text" id="spin6" placeholder="Spin"></td>
                <td><input type="text" id="time6" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver7" placeholder="Driver 7"></td>
                <td><input type="text" id="spin7" placeholder="Spin"></td>
                <td><input type="text" id="time7" placeholder="Time"></td>
            </tr>
            <tr>
                <td><input type="text" id="driver8" placeholder="Driver 8"></td>
                <td><input type="text" id="spin8" placeholder="Spin"></td>
                <td><input type="text" id="time8" placeholder="Time"></td>
            </tr>
        </tbody>
    </table>

    <button onclick="updateGrid()">Update Starting Order</button>

    <h2>Starting Order</h2>
    <table>
        <thead>
            <tr>
                <th>Row</th>
                <th>Inside</th>
                <th>Outside</th>
            </tr>
        </thead>
        <tbody id="startingOrder">
            <!-- Starting order will be populated here -->
        </tbody>
    </table>

    <script>
        function updateGrid() {
            let drivers = [];

            // Collect driver data from the input fields
            for (let i = 1; i <= 8; i++) {  // Adjusted loop to include 8 drivers
                let name = document.getElementById(`driver${i}`).value.trim();
                let spinInput = document.getElementById(`spin${i}`).value.trim();
                let timeInput = document.getElementById(`time${i}`).value.trim();

                let spin = parseInt(spinInput, 10);
                let time = parseFloat(timeInput);

                // Only include drivers with valid name, spin, and time
                if (name && !isNaN(spin) && !isNaN(time) && spinInput !== "" && timeInput !== "") {
                    // Treat 00 as the lowest (-2), 0 as the second-lowest (-1)
                    if (spinInput === "00") {
                        spin = -2; // 00 is the lowest
                    } else if (spin === 0) {
                        spin = -1; // 0 is the second-lowest
                    }
                    drivers.push({ name, spin, time, originalSpin: spinInput }); // Store original spin for display
                }
            }

            // Sort by spin first (lowest to highest), then qualifying time (fastest to slowest)
            drivers.sort((a, b) => a.spin - b.spin || a.time - b.time);

            let startingOrderHTML = "";
            let row = 1;

            // Pair drivers into Inside/Outside for each row
            for (let i = 0; i < drivers.length; i += 2) {
                let insideDriver = drivers[i];
                let outsideDriver = drivers[i + 1];

                // Format the Inside driver
                let insideDisplaySpin = insideDriver.originalSpin;
                let insideDisplayTime = insideDriver.time.toFixed(3).padStart(6, "0");
                let insideText = `${insideDriver.name} (#${insideDisplaySpin}, ${insideDisplayTime}s)`;

                // Format the Outside driver (if exists)
                let outsideText = "";
                let tieClass = "";

                if (outsideDriver) {
                    let outsideDisplaySpin = outsideDriver.originalSpin;
                    let outsideDisplayTime = outsideDriver.time.toFixed(3).padStart(6, "0");
                    outsideText = `${outsideDriver.name} (#${outsideDisplaySpin}, ${outsideDisplayTime}s)`;

                    // Check for a tie within the same row (Inside and Outside have the same spin AND time)
                    if (insideDriver.spin === outsideDriver.spin && insideDriver.time === outsideDriver.time) {
                        tieClass = "highlight";
                    }
                }

                // Check for a tie with the Inside driver of the next row (if applicable)
                let nextInsideDriver = drivers[i + 2]; // The Inside driver of the next row
                if (nextInsideDriver && outsideDriver && outsideDriver.spin === nextInsideDriver.spin && outsideDriver.time === nextInsideDriver.time) {
                    tieClass = "highlight";
                }

                // Add the row to the table
                startingOrderHTML += `<tr class="${tieClass}"><td>${row}</td><td>${insideText}</td><td>${outsideText}</td></tr>`;
                row++;
            }

            // Update the Starting Order table
            document.getElementById("startingOrder").innerHTML = startingOrderHTML;
        }
    </script>

</body>
</html>
