<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Outlaw Kart Qualifying Grid</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        table, th, td {
            border: 1px solid #000;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px 12px;
            text-align: center;
        }
        input {
            width: 80px;
        }
        .button {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>Outlaw Kart Qualifying</h2>
    <table>
        <thead>
            <tr>
                <th>Driver</th>
                <th>Spin #</th>
                <th>Qual Time</th>
            </tr>
        </thead>
        <tbody>
            <!-- Driver rows -->
            <script>
                for (let i = 1; i <= 8; i++) {
                    document.write(`
                        <tr>
                            <td><input type="text" id="driver${i}" oninput="saveFormData(); updateGrid()"></td>
                            <td><input type="text" id="spin${i}" oninput="restrictSpin(this); saveFormData(); updateGrid()"></td>
                            <td><input type="text" id="qual${i}" oninput="formatTime(this); saveFormData()"></td>
                        </tr>
                    `);
                }
            </script>
        </tbody>
    </table>

    <button class="button" onclick="clearForm()">Clear</button>

    <h3>Starting Order</h3>
    <table>
        <thead>
            <tr>
                <th>Row</th>
                <th>Inside</th>
                <th>Outside</th>
            </tr>
        </thead>
        <tbody id="startingOrderBody"></tbody>
    </table>

    <script>
        function restrictSpin(input) {
            let val = input.value.trim();

            if (val === "00") {
                input.value = "00";
                return;
            }

            let num = parseInt(val, 10);
            if (!isNaN(num)) {
                if (num < 0) num = 0;
                if (num > 36) num = 36;
                input.value = num.toString();
            } else {
                input.value = '';
            }
        }

        function formatTime(input) {
            input.value = input.value.replace(/[^0-9.]/g, '').substring(0, 6);
        }

        function saveFormData() {
            for (let i = 1; i <= 8; i++) {
                localStorage.setItem(`driver${i}`, document.getElementById(`driver${i}`).value);
                localStorage.setItem(`spin${i}`, document.getElementById(`spin${i}`).value);
                localStorage.setItem(`qual${i}`, document.getElementById(`qual${i}`).value);
            }
        }

        function loadFormData() {
            for (let i = 1; i <= 8; i++) {
                document.getElementById(`driver${i}`).value = localStorage.getItem(`driver${i}`) || '';
                document.getElementById(`spin${i}`).value = localStorage.getItem(`spin${i}`) || '';
                document.getElementById(`qual${i}`).value = localStorage.getItem(`qual${i}`) || '';
            }
        }

        function clearForm() {
            for (let i = 1; i <= 8; i++) {
                document.getElementById(`driver${i}`).value = '';
                document.getElementById(`spin${i}`).value = '';
                document.getElementById(`qual${i}`).value = '';
                localStorage.removeItem(`driver${i}`);
                localStorage.removeItem(`spin${i}`);
                localStorage.removeItem(`qual${i}`);
            }
            updateGrid();
        }

        function updateGrid() {
            const driverData = [];

            for (let i = 1; i <= 8; i++) {
                const name = document.getElementById(`driver${i}`).value.trim();
                const spin = document.getElementById(`spin${i}`).value.trim();

                if (name && spin !== '') {
                    let sortValue = (spin === "00") ? -1 : parseInt(spin, 10);
                    if (!isNaN(sortValue) || spin === "00") {
                        driverData.push({ name, spin, sortValue });
                    }
                }
            }

            driverData.sort((a, b) => a.sortValue - b.sortValue);

            const gridBody = document.getElementById("startingOrderBody");
            gridBody.innerHTML = '';

            for (let row = 0; row < driverData.length; row += 2) {
                const tr = document.createElement("tr");

                const rowNumber = Math.floor(row / 2) + 1;
                const insideDriver = driverData[row]?.name || '';
                const outsideDriver = driverData[row + 1]?.name || '';

                tr.innerHTML = `
                    <td>${rowNumber}</td>
                    <td>${insideDriver}</td>
                    <td>${outsideDriver}</td>
                `;
                gridBody.appendChild(tr);
            }
        }

        // Load saved data and update grid on page load
        window.onload = function() {
            loadFormData();
            updateGrid();
        };
    </script>
</body>
</html>
